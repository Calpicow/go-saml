package saml_test

import (
	"testing"

	"github.com/RobotsAndPencils/go-saml"
	"github.com/RobotsAndPencils/go-saml/packager"
	"github.com/stretchr/testify/assert"
)

func TestApplyLogoutRequest(t *testing.T) {
	settings := GetStandardSettings()
	request := saml.ApplyLogoutRequest(&settings, saml.NewLogoutRequest(), "nameid", "sessionindex")
	request.ID = "id"
	request.IssueInstant = "statictime"
	request.Signature.SignedInfo.SamlsigReference.URI = "#id"

	result, err := packager.CompressedEncodedSignedStringFromKey(request, settings.SPPrivateKey())
	assert.NoError(t, err)

	expected := `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`
	assert.Equal(t, expected, result)
}
